!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i);class s{constructor(t,i,e){this.parentHTML=t,this.html=t.appendChild(document.createElement("div")),this.html.className="check",this.items=[],i.names.forEach((t,s)=>{this.items.push(new h(this.html,i.colors[s],t,s,e))}),setTimeout(()=>this.items.forEach(t=>{t.html.style.opacity=1,t.html.style.transform="perspective(10px) translateZ(0)"}),0),this.events="ontouchstart"in window?{down:"ontouchstart",up:"ontouchend"}:{down:"onmousedown",up:"onmouseup"},this.html[this.events.down]=this.handleBehaviour.bind(this)}handleBehaviour(t){let i=t.target;if(i===this.html)return;for(;!i.classList.contains("checkBox");)i=i.parentNode;let e=+i.getAttribute("id"),s=setTimeout(()=>{this.html[this.events.up]=null,this.delegateGroup(e)},500);this.html[this.events.up]=(()=>{clearTimeout(s),this.delegate(e),this.html[this.events.up]=null})}delegateGroup(t){this.isOneActive(t)?this.items.forEach(t=>t.react(!0)):this.items.forEach((i,e)=>{t===e?i.react(!0):i.react(!1)})}delegate(t){if(this.isOneActive(t))return void this.items[t].shake();let i=!this.items[t].state;this.items[t].react(i)}isOneActive(t){let i;return 0===(i=[].reduce.call(this.html.childNodes,(i,e,s)=>t===s?i:i+=+e.dataset.isActive,0))}clear(){this.items.forEach(t=>{t.html.style.opacity=0,t.html.style.transform="perspective(10px) translateZ(-10px)"}),setTimeout(()=>this.html.remove(),200)}}class h{constructor(t,i,e,s,h){this.name=e,this.color=i,this.parentHTML=t,this.buildHTML(s),this.state=!0,this.index=s,this.onChange=h,this.html.dataset.isActive=1}shake(){let t=this.html.classList;t.contains("shakingBlock")||(t.add("shakingBlock"),setTimeout(()=>t.remove("shakingBlock"),800))}react(t){this.html.dataset.isActive=+t,this.state=t,this.onChange(this.index,t),this.reDraw(t)}reDraw(t){t?(this.html.style.background=this.color,this.label.style.color="white",this.stateMarkHTML.style.transform="scale(1)"):(this.html.style.background="rgba(0,0,0,0)",this.label.style.color=this.color,this.stateMarkHTML.style.transform="scale(0)")}buildHTML(t){let i=this.parentHTML;this.html=i.appendChild(document.createElement("div"));let e=this.html;e.className="checkBox",e.style.background=this.color,e.style.borderColor=this.color,e.id=t,this.stateMarkHTML=e.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg"));let s=this.stateMarkHTML;s.setAttribute("viewBox","0 0 46 46"),s.setAttribute("class","checkMark"),s.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d","M20.687,38.332c-2.072,2.072-5.434,2.072-7.505,0L1.554,26.704c-2.072-2.071-2.072-5.433,0-7.504    c2.071-2.072,5.433-2.072,7.505,0l6.928,6.927c0.523,0.522,1.372,0.522,1.896,0L36.642,7.368c2.071-2.072,5.433-2.072,7.505,0    c0.995,0.995,1.554,2.345,1.554,3.752c0,1.407-0.559,2.757-1.554,3.752L20.687,38.332z"),this.label=e.appendChild(document.createElement("div")),this.label.textContent=this.name,this.label.className="checkLabel"}}class a{constructor(t,i,e,s,h,a,n){this.chartType=t,this.ctx=i,this.width=e,this.height=s,this.sliderK=h,this.sliderWidth=e*h,this.data=a,this.boxHTML=n,this.animationHappens=!0}onResize(t,i){this.width=t,this.height=i,this.sliderWidth=this.sliderK*t,this.chartHeight=this.height*this.ratio[1]/100,this.chartMarginTop=this.height*this.ratio[0]/100,this.chartController.onResize(this.width,this.chartHeight,this.chartMarginTop)}onTumblerUpdate(t,i,e){this.shouldChartsUpdate=!0,this.tumblerStart=t,this.tumblerWidth=i;let s=this.data.valuesY[0].length,h=s-1;this.fittedLeftBoundIndex=Math.ceil(h*t/this.sliderWidth),this.fittedRightBoundIndex=Math.floor(h*(t+i)/this.sliderWidth),this.fittedRightBoundIndex<this.fittedLeftBoundIndex&&(this.fittedLeftBoundIndex=this.fittedRightBoundIndex),!0===this.transitionHappens||this.chartController.updateVerticalBounds(this.fittedLeftBoundIndex,this.fittedRightBoundIndex),e&&this.updateHeaderDate(this.defineHeaderDateLabel(this.fittedLeftBoundIndex,this.fittedRightBoundIndex),this.zoomed),this.scaleX=this.width/s*(this.sliderWidth/i)}setChecks(){[].forEach.call(this.boxHTML.querySelectorAll(".checkBox"),(t,i)=>{!1===!!parseInt(t.dataset.isActive)&&(this.chartController.items[i].visibility=0,this.chartController.checks[i]=!1)})}calcCoordsX(t,i,e,s){let h=[];for(let a=0;a<i-t+1;a++){let i=(this.data.valuesNumber-t-a)*e,n=this.width-i+s;h.push(Math.round(100*n)/100)}return h}onCheckBoxesStateChange(t,i){this.markings&&"lines2Y"===this.chartType&&(this.markings[t].initVisibilityAnimation(i),0===t&&this.markings[1].setStaticVisibility(!i)),this.chartController.animateVisibility(t,i),this.chartController.updateVerticalBounds(this.fittedLeftBoundIndex,this.fittedRightBoundIndex,1),this.shouldChartsUpdate=!0,this.animationHappens||this.draw()}animate(t){if(!t)return this.shouldChartsUpdate=!1,void(this.animationHappens=!1);this.animationHappens=!0,this.animationHappens&&requestAnimationFrame(()=>this.draw())}updateDT(){let t=Date.now();this.dt=t-this.lastTime,this.lastTime=t}initAppearAnimation(t,i){this.updateDT(),this.dur=i,this.durProgress=0,this.ctx.globalAlpha=0,this.transitionHappens=!0,this.animate(!0),this.transitionStepOfS=(this.tumblerStart-t.tumblerStart)/i,this.transitionDiffOfTW=this.tumblerWidth-t.tumblerWidth,this.transitionStepOfTW=this.transitionDiffOfTW/i,this.zoomDir=Math.sign(this.transitionStepOfTW),this.targetStart=this.tumblerStart,this.targetTumblerWidth=this.tumblerWidth,this.tumblerStart=t.tumblerStart,this.tumblerWidth=t.tumblerWidth,requestAnimationFrame(()=>this.animateAppear())}animateAppear(){if(this.updateDT(),this.durProgress+=this.dt,this.durProgress>=this.dur)this.ctx.globalAlpha=1,this.tumblerStart=this.targetStart,this.tumblerWidth=this.targetTumblerWidth,this.transitionHappens=!1,this.onTumblerUpdate(this.tumblerStart,this.tumblerWidth,!1),delete this.targetStart,delete this.targetTumblerWidth,delete this.zoomDir;else{let t=this.transitionStepOfS*this.dt,i=this.transitionStepOfTW*this.dt,e=(this.targetTumblerWidth-this.tumblerWidth)/this.transitionDiffOfTW;this.ctx.globalAlpha=1-e,this.onTumblerUpdate(this.tumblerStart+t,this.tumblerWidth+i,!1),requestAnimationFrame(()=>this.animateAppear())}}initDisappearAnimation(t,i,e){this.updateDT(),this.dur=i,this.durProgress=0,this.transitionHappens=!0,this.animate(!0),this.transitionStepOfS=(t.tumblerStart-this.tumblerStart)/i,this.transitionDiffOfTW=t.tumblerWidth-this.tumblerWidth,this.transitionStepOfTW=this.transitionDiffOfTW/i,this.zoomDir=Math.sign(this.transitionStepOfTW),this.zoomOffset=Math.sign(this.transitionStepOfTW),this.targetStart=t.tumblerStart,this.targetTumblerWidth=t.tumblerWidth,requestAnimationFrame(()=>this.animateDisappear(e))}animateDisappear(t){if(this.updateDT(),this.durProgress+=this.dt,this.durProgress>=this.dur)this.ctx.globalAlpha=0,t(!0);else{let i=this.transitionStepOfS*this.dt,e=this.transitionStepOfTW*this.dt,s=(this.targetTumblerWidth-this.tumblerWidth)/this.transitionDiffOfTW;this.ctx.globalAlpha=s,this.onTumblerUpdate(this.tumblerStart+i,this.tumblerWidth+e,!1),requestAnimationFrame(()=>this.animateDisappear(t))}}}let n=["January","February","March","April","May","June","July","August","September","October","November","December"];class r{constructor(t,i,e,s,h,a,n){this.ctx=t,this.width=i,this.height=e,this.marginTop=s,this.chartHeight=e+s,this.data=h,this.drawPopup=a,this.deletePopup=n,this.items=[],this.amounts=[],this.isHightlight=!1,this.animationHappens=!1,this.axisYAnimationDuration=200,this.axisYmax={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:this.axisYAnimationDuration},this.axisYmin={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:this.axisYAnimationDuration},this.lastTime=0,this.checks=new Array(this.data.valuesY.length).fill(!0)}onResize(t,i,e){this.width=t,this.height=i,this.marginTop=e,this.chartHeight=i+e,this.items.forEach(s=>{s.width=t,s.height=i,s.marginTop=e})}animate(t){let i=t.newV-t.curV;if(0!==i){if(null===t.lastSavedNewV)return t.lastSavedNewV=t.curV=t.newV,1;if(t.lastSavedNewV!==t.newV)return t.lastSavedNewV=t.newV,t.animBias=Math.round(i/t.animDuration*100)/100,2;let e=Math.round(100*(t.curV+t.animBias*this.dt))/100;return i>0&&e<t.newV||i<0&&e>t.newV?(t.curV=e,3):(t.curV=t.newV,4)}return 0}updateDT(){let t=Date.now();this.dt=t-this.lastTime,this.lastTime=t}animateMarking(){}animateVisibility(t,i){this.items[t].initVisibilityAnimation(i,this.axisYAnimationDuration),this.checks[t]=i}unhighlight(){this.isHightlight=!1}prepareValue(t){return String(t).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}drawVerticalLine(){let t=this.ctx;t.strokeStyle=window.theme.gridLines,t.lineWidth=1,t.beginPath(),t.moveTo(this.focusX,0),t.lineTo(this.focusX,this.chartHeight),t.stroke()}}class l{constructor(t,i,e,s,h){var a;this.ctx=t,this.height=i,this.marginTop=e,this.color=((a=s.slice(1).match(/.{2}/g))[0]=parseInt(a[0],16),a[1]=parseInt(a[1],16),a[2]=parseInt(a[2],16),a.join(",")),this.values=h,this.visibility=1,this.coordsY=[],this.animationHappens=!1}initVisibilityAnimation(t,i){cancelAnimationFrame(this.requestID),this.animStep=1/i,this.lastTime=Date.now(),this.animateVisibility(t)}animateVisibility(t){let i=Date.now();this.dt=i-this.lastTime,this.lastTime=i,!0===t?(this.visibility+=this.animStep*this.dt,this.visibility>=1&&(this.visibility=1)):(this.visibility-=this.animStep*this.dt,this.visibility<=0&&(this.visibility=0));let e=+t;this.visibility===e?this.animationHappens=!1:(this.animationHappens=!0,this.requestID=requestAnimationFrame(()=>this.animateVisibility(t)))}}class o extends l{constructor(t,i,e,s,h,a){super(t,i,e,s,h),this.circleRadius=6,this.lineWidth=a}updateCoordsY(t,i,e,s){this.coordsY=[];for(let h=0;h<i-t+1;h++){let i=e-s,a=(e-this.values[h+t])/i*this.height+this.marginTop;this.coordsY.push(Math.round(100*a)/100)}}draw(t){if(0!==this.visibility){let i=this.ctx;i.strokeStyle=`rgba(${this.color}, ${this.visibility})`,i.lineWidth=this.lineWidth,i.lineCap="round",i.lineJoin="round",i.beginPath();for(let i=0;i<t.length;i++)this.ctx.lineTo(t[i],this.coordsY[i]);i.stroke()}return this.animationHappens}drawCircleInPoint(t,i){if(0===this.visibility)return;let e=this.ctx;e.strokeStyle=`rgba(${this.color}, ${this.visibility})`,e.lineWidth=this.lineWidth,e.beginPath();let s=i[1]-i[0],h=Math.floor((t-i[0])/s);h<0&&(h=0);let a=this.coordsY[h+1]-this.coordsY[h]||0,n=this.coordsY[h]+a*(t-i[h])/s;e.arc(t,n,this.circleRadius,0,2*Math.PI,!0),e.stroke(),e.fillStyle=window.theme.background,e.arc(t,n,this.circleRadius-this.lineWidth,0,2*Math.PI,!0),e.fill()}}class d extends r{constructor(t,i,e,s,h,a,n){super(t,i,e,s,h,a),this.lineWidth=3,h.valuesY.forEach((t,i)=>this.items.push(new o(this.ctx,e,s,h.colors[i],t,this.lineWidth))),this.animateMarking=n,this.verticalLineOpacity=.5,this.circlesAnim={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:100}}updateVerticalBounds(t,i){let e=this.defineVerticalBounds(t,i);this.axisYmax.newV=e.max,this.axisYmin.newV=e.min}defineVerticalBounds(t,i){let[e,s]=[[],[]];return this.checks.forEach((h,a)=>{if(!1===h)return;let n=this.data.valuesY[a].slice(t,i);e.push(Math.max(...n)),s.push(Math.min(...n))}),{max:Math.max(...e),min:Math.min(...s)}}draw(t,i,e,s){let h=!1;if(t){this.updateDT();let t=this.animate(this.axisYmax),i=this.animate(this.axisYmin);2!==t&&2!==i||this.animateMarking(this.axisYAnimationDuration,this.axisYmax.newV,this.axisYmin.newV),h=!!t||!!i||h,this.items.forEach(t=>t.updateCoordsY(e,s,this.axisYmax.curV,this.axisYmin.curV))}return h=this.items.reduce((t,e)=>e.draw(i)||t,!1)||h,!0===this.isHightlight?(!0!==window.sliderDown&&(h=!!this.animate(this.circlesAnim)||h,this.items.forEach(t=>t.drawCircleInPoint(this.circlesAnim.curV,i))),this.drawVerticalLine()):this.circlesAnim.lastSavedNewV=null,h}highlightItem(t,i,e,s,h){this.focusX=t,this.focusY=i,this.isHightlight=!0;let a=Math.floor((t-e[0])/s);a<0&&(a=0),this.circlesAnim.newV=e[a];let n=this.items.reduce((t,i,e)=>(!0===this.checks[e]?t.push({name:this.data.names[e],value:this.prepareValue(this.data.valuesY[e][a+h])}):t.push({name:"",value:""}),t),[]);this.drawPopup(a,n)}}class u extends r{constructor(t,i,e,s,h){super(t,i,e,s,h),this.lineWidth=2,h.valuesY.forEach((t,i)=>this.items.push(new o(this.ctx,e,s,h.colors[i],t,this.lineWidth)))}updateVerticalBounds(t,i){let e=this.defineVerticalBounds(t,i);this.axisYmax.newV=e.max,this.axisYmin.newV=e.min}defineVerticalBounds(t,i){let[e,s]=[[],[]];return this.checks.forEach((h,a)=>{if(!1===h)return;let n=this.data.valuesY[a].slice(t,i);e.push(Math.max(...n)),s.push(Math.min(...n))}),{max:Math.max(...e),min:Math.min(...s)}}draw(t,i,e,s){let h=!1;this.updateDT();let a=!!this.animate(this.axisYmax),n=!!this.animate(this.axisYmin);return h=!!a||!!n||h,this.items.forEach(t=>t.updateCoordsY(e,s,this.axisYmax.curV,this.axisYmin.curV)),h=this.items.reduce((t,e)=>e.draw(i)||t,!1)||h}}class m extends r{constructor(t,i,e,s,h,a,n){super(t,i,e,s,h,a),this.lineWidth=3;for(let t=0;t<2;t++){let i=h.valuesY[t];this.items.push(new o(this.ctx,e,s,h.colors[t],i,this.lineWidth))}this.animateMarking=n,this.verticalLineOpacity=.5,this.axisYmax2={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:this.axisYAnimationDuration},this.axisYmin2={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:this.axisYAnimationDuration},this.circlesAnim={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:100}}updateVerticalBounds(t,i){let e=this.defineVerticalBounds(t,i);this.axisYmax.newV=e.max,this.axisYmin.newV=e.min,this.axisYmax2.newV=e.max2,this.axisYmin2.newV=e.min2}defineVerticalBounds(t,i){let e=this.data.valuesY[0].slice(t,i),s=this.data.valuesY[1].slice(t,i);return{max:Math.max(...e),min:Math.min(...e),max2:Math.max(...s),min2:Math.min(...s)}}draw(t,i,e,s){let h=!1;if(t){this.updateDT();let t=this.animate(this.axisYmax),i=this.animate(this.axisYmin),a=this.animate(this.axisYmax2),n=this.animate(this.axisYmin2);h=!!t||!!i||!!a||!!n||h,2!==t&&2!==i||this.animateMarking(this.axisYAnimationDuration,this.axisYmax.newV,this.axisYmin.newV,0),2!==a&&2!==n||this.animateMarking(this.axisYAnimationDuration,this.axisYmax2.newV,this.axisYmin2.newV,1),this.items[0].updateCoordsY(e,s,this.axisYmax.curV,this.axisYmin.curV),this.items[1].updateCoordsY(e,s,this.axisYmax2.curV,this.axisYmin2.curV)}return h=this.items.reduce((t,e)=>e.draw(i)||t,!1)||h,!0===this.isHightlight?(!0!==window.sliderDown&&(h=!!this.animate(this.circlesAnim)||h,this.items.forEach(t=>t.drawCircleInPoint(this.circlesAnim.curV,i))),this.drawVerticalLine()):this.circlesAnim.lastSavedNewV=null,h}highlightItem(t,i,e,s,h){this.focusX=t,this.focusY=i,this.isHightlight=!0;let a=Math.floor((t-e[0])/s);a<0&&(a=0),this.circlesAnim.newV=e[a];let n=this.items.reduce((t,i,e)=>(!0===this.checks[e]?t.push({name:this.data.names[e],value:this.prepareValue(this.data.valuesY[e][a+h])}):t.push({name:"",value:""}),t),[]);this.drawPopup(a,n)}}class c extends r{constructor(t,i,e,s,h,a){super(t,i,e,s,h,a),this.linesWidth=2;for(let t=0;t<2;t++){let i=h.valuesY[t];this.items.push(new o(this.ctx,e,s,h.colors[t],i,this.lineWidth))}this.axisYmax2={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:this.axisYAnimationDuration},this.axisYmin2={curV:0,newV:null,lastSavedNewV:null,animBias:0,animDuration:this.axisYAnimationDuration}}updateVerticalBounds(t,i){let e=this.defineVerticalBounds(t,i);this.axisYmax.newV=e.max,this.axisYmin.newV=e.min,this.axisYmax2.newV=e.max2,this.axisYmin2.newV=e.min2}defineVerticalBounds(t,i){let e=this.data.valuesY[0].slice(t,i),s=this.data.valuesY[1].slice(t,i);return{max:Math.max(...e),min:Math.min(...e),max2:Math.max(...s),min2:Math.min(...s)}}draw(t,i,e,s){let h=!1;this.updateDT();let a=this.animate(this.axisYmax),n=this.animate(this.axisYmin),r=this.animate(this.axisYmax2),l=this.animate(this.axisYmin2);return h=!!a||!!n||!!r||!!l||h,this.items[0].updateCoordsY(e,s,this.axisYmax.curV,this.axisYmin.curV),this.items[1].updateCoordsY(e,s,this.axisYmax2.curV,this.axisYmin2.curV),h=this.items.reduce((t,e)=>e.draw(i)||t,!1)||h}}function p(t){var i=t.slice(1).match(/.{2}/g);return i[0]=parseInt(i[0],16),i[1]=parseInt(i[1],16),i[2]=parseInt(i[2],16),i.join(",")}class g extends r{constructor(t,i,e,s,h,a){super(t,i,e,s,h,a)}updateCoordsY(t,i){this.coordsY=[];for(let e=0;e<i-t+1;e++){let i=this.height-this.data.valuesY[0][e+t]*(this.height/this.axisYmax.curV)+this.marginTop;this.coordsY.push(Math.round(100*i)/100)}}updateVerticalBounds(t,i){let e=this.defineVerticalBounds(t,i);this.axisYmax.newV=e.max}defineVerticalBounds(t,i){return{max:Math.max(...this.data.valuesY[0].slice(t,i)),min:0}}draw(t,i,e,s){let h=!1;if(t){this.updateDT();let t=this.animate(this.axisYmax);h=!!t||h,2===t&&this.animateMarking(this.axisYAnimationDuration,this.axisYmax.newV,0),this.updateCoordsY(e,s)}let a=this.ctx;a.beginPath();let n=i[1]-i[0],r=i[i.length-1]+n,l=this.height+this.marginTop;for(let t=0;t<this.coordsY.length;t++)l=this.drawSegment(l,i[t],this.coordsY[t]);return a.lineTo(r,l),a.lineTo(r,this.height+this.marginTop),a.fillStyle=`rgba(${this.color}, ${this.visibility})`,a.fill(),!0===this.isHightlight&&this.drawMask(i,n),h}drawSegment(t,i,e){return this.ctx.lineTo(i,t),this.ctx.lineTo(i,e),e}}class b extends g{constructor(t,i,e,s,h,a,n){super(t,i,e,s,h,a),this.color=p(this.data.colors[0]),this.visibility=1,this.chartHeight=e+s,this.animateMarking=n}highlightItem(t,i,e,s,h){this.focusX=t,this.focusY=i,this.isHightlight=!0;let a=Math.floor((t-e[0])/s);a<0&&(a=0),this.highlightedIndex=a;let n=[{name:this.data.names[0],value:this.prepareValue(this.data.valuesY[0][a+h])}];this.drawPopup(a,n)}unhighlight(){this.isHightlight=!1,this.visibility=1}drawMask(t,i){let e=this.ctx,s=this.highlightedIndex;e.beginPath(),e.moveTo(0,0),e.lineTo(0,this.height+this.marginTop),e.lineTo(t[s],this.height+this.marginTop),e.lineTo(t[s],this.coordsY[s]),e.lineTo(t[s]+i,this.coordsY[s]),e.lineTo(t[s]+i,this.height+this.marginTop),e.lineTo(this.width,this.height+this.marginTop),e.lineTo(this.width,0),e.fillStyle=window.theme.highlightMask,e.fill()}}class f extends g{constructor(t,i,e,s,h){super(t,i,e,s,h),this.color=p(this.data.colors[0]),this.visibility=1}}class T extends l{constructor(t,i,e,s,h){super(t,i,e,s,h)}updateCoordsY(t,i,e,s){this.coordsY=[];for(let i=0;i<s.length;i++){let h=this.height-s[i]*this.height/e+this.marginTop;this.coordsY.push(Math.round(100*h)/100),s[i]-=this.values[i+t]*this.visibility}return s}draw(t,i){if(0!==this.visibility){let e=this.ctx;e.beginPath();let s=this.coordsY.reduce(function(i,s,h){let a=t[h];return e.lineTo(a,i),e.lineTo(a,s),s},this.height+this.marginTop);e.lineTo(i,s),e.lineTo(i,this.height+this.marginTop),e.fillStyle=`rgba(${this.color}, ${this.visibility})`,e.fill()}return this.animationHappens}}class w extends r{constructor(t,i,e,s,h,a){super(t,i,e,s,h,a),h.valuesY.forEach((t,i)=>this.items.push(new T(this.ctx,e,s,h.colors[i],t))),this.lastAction=0}updateVerticalBounds(t,i,e=0){let s=this.defineVerticalBounds(t,i);this.axisYmax.newV=s.max,this.lastAction=e}defineVerticalBounds(t,i){let e=this.calcAmounts(t,i,!0);return{amounts:e,max:Math.max(...e),min:0}}calcOneAmount(t){let i=0;return this.data.valuesY.forEach((e,s)=>{i+=e[t]*Number(this.checks[s])}),i}calcAmounts(t,i,e=!0){let s=i-t+1;s<0&&(s=0);let h=new Array(s).fill(0);return e?this.data.valuesY.reduce(function(e,s,h){return s.slice(t,i+1).forEach((t,i)=>{e[i]+=t*Number(this.checks[h])}),e}.bind(this),h):this.data.valuesY.reduce(function(e,s,h){return s.slice(t,i+1).forEach((t,i)=>{e[i]+=t*this.items[h].visibility}),e}.bind(this),h)}draw(t,i,e,s){let h=!1,a=this.items.length-1;if(t){this.updateDT();let t=this.animate(this.axisYmax);2===t&&this.animateMarking(this.axisYAnimationDuration,this.axisYmax.newV,0),h=!!t||h;let i=this.calcAmounts(e,s,!1),n=0===this.lastAction?this.axisYmax.curV:Math.max(...i);for(let t=0;t<this.items.length;t++)i=this.items[a-t].updateCoordsY(e,s,n,i)}let n=i[1]-i[0],r=i[i.length-1]+n;for(let t=0;t<this.items.length;t++)h=this.items[a-t].draw(i,r)||h;return!0===this.isHightlight&&this.drawMask(i,n),h}}class x extends w{constructor(t,i,e,s,h,a,n){super(t,i,e,s,h,a),this.animateMarking=n}highlightItem(t,i,e,s,h){this.focusX=t,this.focusY=i,this.isHightlight=!0;let a=Math.floor((t-e[0])/s);a<0&&(a=0),this.highlightedIndex=a;let n=this.calcOneAmount(a+h);this.highlightedAmount=n;let r=this.items.reduce((t,i,e)=>(!0===this.checks[e]?t.push({name:this.data.names[e],value:this.prepareValue(this.data.valuesY[e][a+h])}):t.push({name:"",value:""}),t),[]);r.push({name:"All",value:this.prepareValue(n)}),this.drawPopup(a,r)}drawMask(t,i){let e=this.ctx,s=this.highlightedIndex;e.beginPath();let h=this.height-this.highlightedAmount*this.height/this.axisYmax.curV+this.marginTop;e.moveTo(0,0),e.lineTo(0,this.height+this.marginTop),e.lineTo(t[s],this.height+this.marginTop),e.lineTo(t[s],h),e.lineTo(t[s]+i,h),e.lineTo(t[s]+i,this.height+this.marginTop),e.lineTo(this.width,this.height+this.marginTop),e.lineTo(this.width,0),e.fillStyle=window.theme.highlightMask,e.fill()}}class v extends w{constructor(t,i,e,s,h){super(t,i,e,s,h)}}class y extends l{constructor(t,i,e,s,h){super(t,i,e,s,h)}updateCoordsY(t,i,e,s){this.coordsY=[];for(let i=0;i<s.length;i++){let h=e[i]/s[i]*this.height+this.marginTop;this.coordsY.push(Math.round(100*h)/100),e[i]+=this.values[i+t]*this.visibility}return e}draw(t,i=!1,e){if(0!==this.visibility){let s=this.ctx;if(s.beginPath(),s.lineTo(t[0],this.height+this.marginTop),!0===i){let i=this.coordsY.reduce(function(i,e,h){let a=t[h];return s.lineTo(a,i),s.lineTo(a,e),e},this.height+this.marginTop);s.lineTo(e,i),s.lineTo(e,this.height+this.marginTop)}else this.coordsY.forEach(function(i,e){let h=t[e];s.lineTo(h,i)});s.lineTo(t[t.length-1],this.height+this.marginTop),s.fillStyle=`rgba(${this.color}, ${this.visibility})`,s.fill()}return this.animationHappens}}class M extends r{constructor(t,i,e,s,h,a){super(t,i,e,s,h,a),h.valuesY.forEach((t,i)=>this.items.push(new y(this.ctx,e,s,h.colors[i],t))),this.columnMode=!1}updateVerticalBounds(t,i){}calcOneAmount(t){let i=0;return this.data.valuesY.forEach((e,s)=>{i+=e[t]*Number(this.checks[s])}),i}calcAmounts(t,i,e=!0){let s=i-t+1;s<0&&(s=0);let h=new Array(s).fill(0);return e?this.data.valuesY.reduce(function(e,s,h){return s.slice(t,i+1).forEach((t,i)=>{e[i]+=t*Number(this.checks[h])}),e}.bind(this),h):this.data.valuesY.reduce(function(e,s,h){return s.slice(t,i+1).forEach((t,i)=>{e[i]+=t*this.items[h].visibility}),e}.bind(this),h)}draw(t,i,e,s){let h=this.items.length-1;if(t){let t=this.calcAmounts(e,s,!1),i=new Array(t.length).fill(0);for(let a=0;a<this.items.length;a++)i=this.items[h-a].updateCoordsY(e,s,i,t)}let a=!1;for(let t=0;t<this.items.length;t++)a=this.items[h-t].draw(i,this.columnMode,this.width)||a;return!0===this.isHightlight&&this.drawVerticalLine(i),a}highlightItem(t,i,e,s,h){this.focusX=t,this.focusY=i,this.isHightlight=!0;let a=Math.floor((t-e[0])/s);a<0&&(a=0),this.highlightedIndex=a;let n=this.calcOneAmount(a+h),r=this.items.reduce((t,i,e)=>{if(!0===this.checks[e]){let i=this.data.valuesY[e][a+h];t.push({percentage:Math.round(i/n*100)+"%",name:this.data.names[e],value:this.prepareValue(i)})}else t.push({percentage:"",name:"",value:""});return t},[]);this.drawPopup(a,r)}drawVerticalLine(t){let i=this.ctx;i.strokeStyle=window.theme.gridLines,i.lineWidth=1,i.beginPath();let e=t[this.highlightedIndex];i.moveTo(e,0),i.lineTo(e,this.chartHeight),i.stroke()}}class H extends M{constructor(t,i,e,s,h,a){super(t,i,e,s,h,a),this.axisYmax.newV=100,this.axisYmin.newV=0}}class S extends M{constructor(t,i,e,s,h){super(t,i,e,s,h)}}class L extends l{constructor(t,i,e,s,h){super(t,null,null,h),this.centerX0=i,this.centerY0=e,this.centerX=i,this.centerY=e,this.radius=s,this.maxLabelSize=2*this.radius/5,this.animationHappens2=!1,this.pushOffset=0}update(t,i,e){this.value=i;let s=2*Math.PI*i/e;this.startAngle=t,this.endAngle=t+s;let h=Math.round(i/e*100);return this.label=h+"%",this.size=this.defineLabelSize(h),this.endAngle}updateDT(){let t=Date.now();this.dt=t-this.lastTime,this.lastTime=t}initPushAnimation(t,i){t!==this.pushDir&&(this.updateDT(),this.animStep=1/i,this.pushDir=t,cancelAnimationFrame(this.requestID2),this.animationHappens2=!0,this.animatePush(t))}animatePush(t){if(this.updateDT(),!0===t){let t=this.pushOffset+this.animStep*this.dt;this.pushOffset=t>=1?1:t}else{let t=this.pushOffset-this.animStep*this.dt;this.pushOffset=t<=0?0:t}let i=this.startAngle-(this.startAngle-this.endAngle)/2;this.centerX=this.centerX0+this.pushOffset*Math.cos(i)*15,this.centerY=this.centerY0+this.pushOffset*Math.sin(i)*15,this.pushOffset===+t?this.animationHappens2=!1:this.requestID2=requestAnimationFrame(()=>this.animatePush(t))}drawPieSliceLabel(t,i,e,s){let h=e-(e-s)/2,a=i*t.toString().length*.8,n=i/2,r=a/2,l=this.radius-(i+a)/4,o=1-Math.abs(e-s)/(2*Math.PI),d=this.centerX+l*o*Math.cos(h)-r,u=this.centerY+l*o*Math.sin(h)+n,m=this.ctx;m.font=`${i}px Verdana`,m.fillStyle="white",m.fillText(t,d,u)}defineLabelSize(t){let i;return(i=t<20?20:t)/100*this.maxLabelSize}drawPieSlice(t,i){let e=this.ctx;e.fillStyle=`rgba(${this.color}, ${this.visibility})`,e.beginPath(),e.moveTo(this.centerX,this.centerY),e.arc(this.centerX,this.centerY,this.radius,t,i),e.closePath(),e.fill()}draw(){return 0!==this.visibility&&(this.ctx.globalCompositeOperation="destination-over",this.drawPieSlice(this.startAngle,this.endAngle),this.ctx.globalCompositeOperation="source-over",this.drawPieSliceLabel(this.label,this.size,this.startAngle,this.endAngle)),this.animationHappens||this.animationHappens2}}class Y{constructor(t,i,e,s,h,a){this.ctx=t,this.width=i,this.height=e,this.marginTop=s,this.data=h,this.drawPopup=a,this.radius=this.height/2,this.centerX=this.width/2,this.centerY=this.height/2+this.marginTop,this.animationDuration=200,this.checks=new Array(this.data.valuesY.length).fill(!0),this.items=[],h.valuesY.forEach((t,i)=>this.items.push(new L(this.ctx,this.centerX,this.centerY,this.radius,h.colors[i]))),this.total=0,this.pieSlicesTotal=[],this.isHightlight=!1,this.animationHappens=!1}onResize(t,i,e){this.height=i,this.marginTop=e,this.width=t,this.radius=this.height/2,this.centerX=this.width/2,this.centerY=this.height/2+this.marginTop,this.items.forEach(t=>{t.centerX0=this.centerX,t.centerY0=this.centerY,t.centerX=this.centerX,t.centerY=this.centerY,t.radius=this.radius,t.maxLabelSize=2*this.radius/5}),this.draw(!0)}updateVerticalBounds(t,i){this.leftBoundIndex=t,this.rightBoundIndex=i}checkEnteringTheCircle(t,i){return(t-this.centerX)*(t-this.centerX)+(i-this.centerY)*(i-this.centerY)<=this.radius*this.radius}highlightItem(t,i){if(this.focusX=t,this.focusY=i,!this.checkEnteringTheCircle(t,i))return!1;{this.isHightlight=!0;let e=Math.atan2(i-this.centerY,t-this.centerX);e<0&&(e+=2*Math.PI);let s=new Array(this.items.length).fill({name:"",value:""});for(let t=0;t<this.items.length;t++){let i=this.items[t];if(e>this.items[t].startAngle&&e<this.items[t].endAngle){s[t]={name:this.data.names[t],value:this.prepareValue(this.items[t].value.toFixed())},this.drawPopup(t,s);let e=0;for(let t=0;t<this.checks.length;++t)1==this.checks[t]&&e++;1===e||i.initPushAnimation(!0,this.animationDuration)}else i.initPushAnimation(!1,this.animationDuration)}}}prepareValue(t){return String(t).replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")}unhighlight(){this.items.forEach(t=>{t.initPushAnimation(!1,this.animationDuration)}),this.isHightlight=!1}animateVisibility(t,i){this.items[t].initVisibilityAnimation(i,this.animationDuration),this.checks[t]=i,this.unhighlight()}calcTotals(){this.pieSlicesTotal=[];for(let t=0;t<this.data.valuesY.length;t++){let i=this.data.valuesY[t].slice(this.leftBoundIndex,this.rightBoundIndex+1),e=0;for(let s=0;s<i.length;s++)e+=i[s]*this.items[t].visibility;this.pieSlicesTotal[t]=Math.floor(e/this.data.freq)}return this.calcSumInArray(this.pieSlicesTotal)}calcSumInArray(t){return t.reduce((t,i)=>t+i,0)}draw(t){if(t){let t=this.calcTotals();this.items.reduce((i,e,s)=>e.update(i,this.pieSlicesTotal[s],t),0)}return this.items.reduce((t,i)=>i.draw()||t,!1)}}function k(t){return t>=1e3&&(t<1e6?t=Math.round(t/1e3*10)/10+"K":t>=1e6&&t<1e9?t=Math.round(t/1e6*10)/10+"M":t>=1e9&&(t=Math.round(t/1e9*10)/10+"B")),t}class A{constructor(t,i,e,s){this.label=t,this.y=e,this.value=i,this.opacity=s,this.step=null}setMoveAnimation(t,i,e){this.targetOpacity=e,this.opacityStep=(e-this.opacity)/i,this.opacitySign=Math.sign(this.opacityStep),this.step=(t-this.y)/i,this.endY=t}animateStep(t){this.step&&(this.opacity+=this.opacityStep*t,this.opacity*this.opacitySign>this.targetOpacity*this.opacitySign&&(this.opacity=this.targetOpacity),this.y+=this.step*t)}finishAnimation(){this.opacity=this.targetOpacity,this.step&&(this.y=this.endY,this.step=null,delete this.endY)}draw(t,i,e,s,h,a,n){let r=this.y;t.strokeStyle=`rgba(${a}, ${this.opacity*n*e})`,t.beginPath(),t.moveTo(0,r),t.lineTo(i,r),t.stroke(),t.fillStyle=`rgba(${s}, ${.5*this.opacity*e})`,t.fillText(this.label,h,r-10)}}class V{constructor(t,i,e,s,h=1,a=0,n=!1,r,l,o){var d;this.linesNumber=5,this.ctx=t,this.height=e,this.width=i,this.marginTop=s,this.bottomBound=s+e,this.maxLineOpacity=.1,this.lineOpacity=this.maxLineOpacity,this.staticVisibility=o,this.visibility=r,this.rightSide=n,l&&(this.customLabelColor=((d=l.slice(1).match(/.{2}/g))[0]=parseInt(d[0],16),d[1]=parseInt(d[1],16),d[2]=parseInt(d[2],16),d.join(","))),this.dif0=h-a,this.min0=a,this.targets=[],this.items=[];for(let t=0;t<this.linesNumber;t++){let i=this.bottomBound-t*e/(this.linesNumber-1);this.targets.push({label:"",value:0,y:i})}this.animationHappens=!1,this.animationHappens2=!1}onResize(t,i,e){this.height=i,this.width=t,this.marginTop=e,this.bottomBound=e+i;for(let t=0;t<this.linesNumber;t++){let e=this.bottomBound-t*i/(this.linesNumber-1);this.targets[t].y=e}this.initAnimation(0,this.max,this.min)}initAnimation(t,i,e=0){if(!isFinite(i)||!isFinite(e))return;!1===this.staticVisibility&&(this.lineOpacity=this.maxLineOpacity),this.animationHappens2=!0,this.dur=this.initDur=t,this.lastTime=Date.now(),this.dif=i-e,this.min=e,this.max=i;let s=this.targets.map(t=>({...t}));for(let t=0;t<this.linesNumber;t++){let i=e+this.dif/Math.floor(this.linesNumber-1)*t,s=k(i);this.targets[t].value=i,this.targets[t].label=s}for(let t=0;t<this.linesNumber;t++){let i=s[t],e=i.value,h=i.label,a=(i.y,this.targets[t]),n=a.value,r=a.label,l=this.items.findIndex(t=>t.label===h);if(~l){let t,i,s=this.targets.find(t=>t.label===h);if(void 0===s){let s=this.calcDY(e);t=a.y+s,i=0}else t=s.y,i=1;this.items[l].setMoveAnimation(t,this.dur,i)}let o=this.items.findIndex(t=>t.label===r);if(~o){let t=this.items[o];t.value=n,t.setMoveAnimation(a.y,this.dur,1)}else{let t=this.calcDY(n),i=new A(r,n,a.y-t,0);i.setMoveAnimation(a.y,this.dur,1),this.items.push(i)}}this.dif0=this.dif,this.min0=this.min,cancelAnimationFrame(this.requestID2),this.animate()}calcDY(t){return((t-this.min0)/this.dif0-(t-this.min)/this.dif)*this.height}animate(){let t=Date.now(),i=t-this.lastTime;this.lastTime=t,this.dur-=i,this.items.forEach(t=>t.animateStep(i)),this.dur>0?this.requestID2=requestAnimationFrame(()=>this.animate()):this.finishAnimation()}finishAnimation(){this.items=this.items.filter(t=>(t.finishAnimation(),0!==t.opacity)),this.lineOpacity=this.staticVisibility?this.maxLineOpacity:0,this.animationHappens2=!1}setStaticVisibility(t){this.staticVisibility=t,this.lineOpacity=t?this.maxLineOpacity:0}draw(){let t=this.customLabelColor?this.customLabelColor:window.theme.XYAxis.slice(5,-5),i=window.theme.gridLines.slice(5,-5),e=this.rightSide?this.width-50:10,s=[this.ctx,this.width,this.visibility,t,e,i,this.lineOpacity];return this.ctx.font="15px Arial",this.ctx.lineWidth=1,this.items.forEach(t=>t.draw(...s)),this.animationHappens||this.animationHappens2}initVisibilityAnimation(t,i=200){cancelAnimationFrame(this.requestID),this.animStep=1/i,this.lastTime=Date.now(),this.animateVisibility(t)}animateVisibility(t){let i=Date.now();this.dt=i-this.lastTime,this.lastTime=i,this.visibility=!0===t?this.visibility>=1?this.visibility=1:this.visibility+this.animStep*this.dt:this.visibility<=0?this.visibility=0:this.visibility-this.animStep*this.dt;let e=+t;this.visibility===e?this.animationHappens=!1:(this.animationHappens=!0,this.requestID=requestAnimationFrame(()=>this.animateVisibility(t)))}}class C{constructor(t,i,e,s){this.ctx=t,this.data=i,this.marginTop=e,this.values=[],this.xIndexes=[],this.visibilities=[],this.visibility=.5,this.animStep=.05,this.appearance=!1,this.prevScope=0,this.zoomDir=1,this.scopeK=Math.round(1/(s/50)*100)/100}onResize(t,i){this.marginTop=t,this.scopeK=Math.round(1/(i/50)*100)/100}update(t,i,e,s,h=!1){let a=e*this.scopeK,n=Math.log(a)/Math.log(2),r=Math.floor(n),l=r<0?0:r,o=3*Math.pow(2,l),d=o-t%o;d===o&&(d=0),this.appearance=!Math.round(n-r);let u=Math.sign(e-this.prevScope);0!==u&&(this.zoomDir=u,this.prevScope=e),this.values=[],this.xIndexes=[],this.visibilities=[];for(let e=t+d;e<i;e+=o){let t;this.xIndexes.push(e),t=!0===h&&(o<12&&!1===this.appearance||o<24&&!0===this.appearance)?`${s[e][4]}:${s[e][5]}`:s[e][1]+" "+s[e][2].slice(0,3),this.values.push(t);let i=2;this.visibilities.push(!!(e%(o*i)))}}animateVisibilityOfOsculant(){-1===this.zoomDir?!0===this.appearance?this.visibility=this.visibility>=1?this.visibility=1:this.visibility+this.animStep:this.visibility=0:!1===this.appearance?this.visibility=this.visibility<=0?this.visibility=0:this.visibility-this.animStep:this.visibility=1}draw(t,i){return this.animateVisibilityOfOsculant(),this.ctx.font="15px Verdana",this.values.forEach((e,s)=>{let h=this.xIndexes[s],a=t[h-i];this.ctx.fillStyle=this.visibilities[s]?`${window.theme.XYAxis.slice(0,-3)}${.5*this.visibility})`:window.theme.XYAxis,this.ctx.fillText(e,a,this.marginTop)}),!Number.isInteger(this.visibility)}}class D{constructor(t,i,e){this.canvasHTML=t,this.sendCoords=i,this.onZoom=e;let s=t.parentNode;this.areaHTML=s.querySelector(".tooltipArea"),this.onResize(),this.isDesktop=!("ontouchstart"in window),this.zoomEvent=this.isDesktop?"onclick":"ontouchstart";let h=this.isDesktop?"onmouseenter":"onclick";this.areaHTML[h]=this.onFocus.bind(this)}onFocus(t){this.sendCoords(t.offsetX,t.offsetY),this.areaHTML.onmousemove=(t=>this.sendCoords(t.offsetX,t.offsetY)),this.areaHTML[this.zoomEvent]=(()=>{if(this.isDesktop)this.onZoom();else{let t=setTimeout(this.onZoom,500);this.areaHTML.ontouchend=(()=>{clearTimeout(t),this.areaHTML.ontouchend=null})}}),this.areaHTML.onmouseleave=(()=>{this.sendCoords(),this.areaHTML.onmousemove=this.areaHTML[this.zoomEvent]=null})}onResize(){let t=this.canvasHTML.style.top,i=this.canvasHTML.offsetHeight,e=this.canvasHTML.offsetWidth;this.areaHTML.style.top=t,this.areaHTML.style.height=i,this.areaHTML.style.width=e}}class B extends a{constructor(t,i,e,s,h,a,r,l,o,u,c){let p;super(t,i,e,s,h,a,o.parentNode),this.html=o,this.updateHeaderDate=u,this.ratio=[10,80,10],this.dates=a.dates.map(t=>(function(t){let i,e,s=Math.ceil(t/31557600)+1969,h=function(t){let i;return t%4==0&&(i=!0),t%100==0&&(i=!1),t%400==0&&(i=!0),i}(s),a=Math.ceil((s-1969)/4),r=Math.ceil(t/86400),l=(r-a)%365,o=t-86400*(r-1),d=Math.floor(o/3600);24===d&&(d=0,++l>(h?365:364)&&(l=0,s++));let u=[31,28,31,30,31,30,31,31,30,31,30,31];!0===h&&(u[1]=29);let m=0;for(let t=0;t<12;t++)if((m+=u[t])>l){i=t,e=l+u[t]-m+1;break}let c=String(Math.floor(o/60)%60);return 1===c.length&&(c="0"+c),[function(t,i,e){t=parseInt(t,10),i=parseInt(i,10);let s=parseInt((14-i)/12,10),h=e-s,a=i+12*s-2,n=parseInt(t+h+parseInt(h/4,10)-parseInt(h/100,10)+parseInt(h/400,10)+31*a/12,10)%7;return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n]}(e,i+1,s),e,n[i],s,d,c]})(t/1e3)),"pie"===t&&this.dividePieData(10);let g=1;switch(t){case"lines":p=d;break;case"lines2Y":p=m,g=2;break;case"stacked":p=x;break;case"daily":p=b;break;case"percentage":p=H;break;case"pie":p=Y,g=0}if("pie"!==this.chartType){let t=this.height*(100-this.ratio[2]+this.ratio[2]/2)/100;this.datesBar=new C(this.ctx,a,t,e)}else{let t={update:()=>{},draw:()=>{},onResize:()=>{}};this.datesBar=t}if(this.chartHeight=this.height*this.ratio[1]/100,this.chartMarginTop=this.height*this.ratio[0]/100,this.chartController=new p(i,this.width,this.chartHeight,this.chartMarginTop,this.data,this.updateTooltip.bind(this),this.animateMarking.bind(this)),"daily"===t||this.setChecks(),this.markings=[],0!==g){let i=[!0,!1];for(let e=0;e<g;e++){let s,h=1;"lines2Y"===t&&(s=this.data.colors[e],0===(h=Number(this.chartController.checks[e]))&&(i[1]=!0)),this.markings.push(new V(this.ctx,this.width,this.chartHeight,this.chartMarginTop,1,0,!!e,h,s,i[e]))}}this.onTumblerUpdate(r,l,!0),this.markings.forEach((t,i)=>{let e=this.chartController.axisYmax.newV,s=this.chartController.axisYmin.newV;this.animateMarking(0,e,s,i)}),this.zoomed=!1,this.upperListener=new D(o,this.onSelectionChange.bind(this),()=>{if(!1!==this.zoomed)return;let t=this.dates[this.popupIndex];c({coordsX:this.coordsX,i:this.popupIndex,l:this.leftBoundIndex},t[1],t[2],t[3])}),this.hoursMode=!1,this.initTooltip()}dividePieData(t){let i=[],e=[];this.dates.forEach((i,s)=>{let h=s*t;for(let s=h;s<h+t;s++)e[s]=i}),this.dates=e,this.data.valuesY.forEach((e,s)=>{i[s]=[],e.forEach((e,h)=>{let a=h*t;for(let h=a;h<a+t;h++)i[s][h]=e})}),this.data={...this.data},this.data.freq=t,this.data.valuesY=i}initTooltip(){let t,i=this.html.parentNode;this.tooltipHTML=i.querySelector(".tooltip"),this.tooltipHTML.innerHTML="",(t=this.tooltipHTML.appendChild(document.createElement("div"))).className="tooltipLine",t.style.margin="pie"===this.chartType?"0":"5px 0",t.appendChild(document.createElement("div")).style.fontWeight="bold",t.appendChild(document.createElement("div"));for(let i=0;i<this.data.valuesY.length+1;i++){if((t=this.tooltipHTML.appendChild(document.createElement("div"))).className="tooltipLine","percentage"===this.chartType){t.appendChild(document.createElement("div")).className="percent"}t.appendChild(document.createElement("div")).className="name";let e=t.appendChild(document.createElement("div"));e.className="value",e.style.color=this.data.colors[i]}}updateTooltip(t,i){let e="";if("pie"!==this.chartType){this.popupIndex=t+this.leftBoundIndex;let i=this.dates[this.popupIndex];if(!0===this.hoursMode){let t=`${i[4]}:${i[5]}`;e=this.singleDate?t:`${i[1]} ${i[2]}, `+t}else e=`${i[0].slice(0,3)}, ${i[1]} ${i[2].slice(0,3)} ${i[3]}`}else e="";let s,h=this.tooltipHTML.childNodes;(s=h[0].childNodes)[0].textContent=e,i.forEach((t,i)=>{s=h[i+1].childNodes,h[i+1].style.margin=""===t.name?"0":"5px 0",Object.getOwnPropertyNames(t).forEach((i,e)=>{s[e].textContent=t[i]})})}onResize(t,i){super.onResize(t,i),this.markings.forEach(i=>i.onResize(t,this.chartHeight,this.chartMarginTop));let e=this.height*(100-this.ratio[2]+this.ratio[2]/2)/100;this.datesBar.onResize(e,t),this.upperListener.onResize()}onTumblerUpdate(t,i,e){super.onTumblerUpdate(t,i,e);let s=Math.floor(50/this.scaleX);s<2&&(s=2),this.leftBoundIndex=this.fittedLeftBoundIndex-s,this.rightBoundIndex=this.fittedRightBoundIndex+2;let h=this.data.valuesY[0].length-1;this.rightBoundIndex>=h&&(this.rightBoundIndex=h),this.leftBoundIndex<0&&(this.leftBoundIndex=0);let a=(this.sliderWidth-(t+i))*this.width/i;this.coordsX=this.calcCoordsX(this.leftBoundIndex,this.rightBoundIndex,this.scaleX,a);let n=(this.width/this.scaleX).toFixed(2);this.datesBar.update(this.leftBoundIndex,this.rightBoundIndex,n,this.dates,this.hoursMode),this.animationHappens||this.draw()}defineHeaderDateLabel(t,i){let e=this.dates[t],s=this.dates[i],h=[e[1],e[2],e[3]],a=[s[1],s[2],s[3]];if(r=a,(n=h).length==r.length&&n.every((t,i)=>t===r[i])){return h=[e[0]+",",...h],this.singleDate=!0,[h]}return this.singleDate=!1,[h,a];var n,r}animateMarking(t,i,e,s=0){this.markings[s].initAnimation(t,i,e)}draw(){let t=!1;this.ctx.clearRect(0,0,this.width,this.height),t=this.chartController.draw(this.shouldChartsUpdate,this.coordsX,this.leftBoundIndex,this.rightBoundIndex)||t,t=this.markings.reduce((t,i)=>i.draw()||t,!1)||t,t=this.datesBar.draw(this.coordsX,this.leftBoundIndex)||t,this.animate(t)}defineTooltipPosition(t,i){let e,s=this.tooltipHTML.offsetWidth,h=this.tooltipHTML.offsetHeight,a=this.height/15,n=this.width/40,r=this.html.offsetLeft,l=this.html.offsetTop,o=!1;if(h/this.height>.25?(o=!0,e=t-s+r-n):e=t-s/2+r,t=e<0?o?t+n:0:e>this.width-s+r?this.width-s+r:e,i-h>-this.height/10)i=i+l-h-a;else{i=i+l+a;let t=this.height-h;i>t&&(i=t)}return[t,i]}onSelectionChange(t,i){if(void 0===t||this.transitionHappens)this.chartController.unhighlight(),this.tooltipHTML.style.opacity=0;else{if(!1===this.chartController.highlightItem(t,i,this.coordsX,this.scaleX,this.leftBoundIndex))return this.onSelectionChange();let e=this.defineTooltipPosition(t,i);this.tooltipHTML.style.left=e[0],this.tooltipHTML.style.top=e[1],this.tooltipHTML.style.opacity=1}this.animationHappens||this.draw()}}function I(t,i,e,s,h,a,n,r){if(void 0===r&&(r=!0),void 0===a&&(a=5),"number"==typeof a)a={tl:a,tr:a,br:a,bl:a};else{var l={tl:0,tr:0,br:0,bl:0};for(var o in l)a[o]=a[o]||l[o]}t.beginPath(),t.moveTo(i+a.tl,e),t.lineTo(i+s-a.tr,e),t.quadraticCurveTo(i+s,e,i+s,e+a.tr),t.lineTo(i+s,e+h-a.br),t.quadraticCurveTo(i+s,e+h,i+s-a.br,e+h),t.lineTo(i+a.bl,e+h),t.quadraticCurveTo(i,e+h,i,e+h-a.bl),t.lineTo(i,e+a.tl),t.quadraticCurveTo(i,e,i+a.tl,e),t.closePath(),n&&t.fill(),r&&t.stroke()}class W extends a{constructor(t,i,e,s,h,a,n,r,l){let o;switch(super(t,i,e,s,h,a,l),this.ratio=[0,100,0],t){case"lines":o=u;break;case"lines2Y":o=c;break;case"stacked":o=v;break;case"daily":o=f;break;case"percentage":o=S}this.chartHeight=this.height*this.ratio[1]/100,this.chartMarginTop=this.height*this.ratio[0]/100,this.chartController=new o(i,e,this.chartHeight,this.chartMarginTop,a),"daily"===t||this.setChecks(),this.onTumblerUpdate(n,r)}onTumblerUpdate(t,i){super.onTumblerUpdate(t,i),this.leftBoundIndex=this.fittedLeftBoundIndex-2,this.rightBoundIndex=this.fittedRightBoundIndex+2;let e=this.data.valuesY[0].length-1;this.rightBoundIndex>=e&&(this.rightBoundIndex=e),this.leftBoundIndex<0&&(this.leftBoundIndex=0);let s=(this.width-(t+i))*this.width/i;this.coordsX=this.calcCoordsX(this.leftBoundIndex,this.rightBoundIndex,this.scaleX,s),this.animationHappens||this.draw()}draw(){let t=this.ctx;t.clearRect(0,0,this.width,this.height);let i=this.chartController.draw(this.shouldChartsUpdate,this.coordsX,this.leftBoundIndex,this.rightBoundIndex);t.globalCompositeOperation="destination-in",I(t,0,0,this.width,this.height,15,!0,!1),t.globalCompositeOperation="source-over",this.animate(i)}onResize(t,i){super.onResize(t,i),this.onTumblerUpdate(0,this.width),this.animationHappens||this.draw()}}class O{constructor(t,i,e,s,h,a){this.ctx=t,this.html=i,this.parentHTML=i.parentNode,this.width=e,this.height=s,this.tumblerLimiter=h,this.minTumblerWidth=this.width/h,this.borders=[16,3],this.upper=a,this.liveDur=200,this.events="ontouchstart"in window?{isDesktop:!1,down:"ontouchstart",up:"ontouchend",move:"ontouchmove",leave:"ontouchend"}:{isDesktop:!0,down:"onmousedown",up:"onmouseup",move:"onmousemove",leave:"onmouseleave"},this.html[this.events.down]=(t=>this.handleTumblerDown(t)),this.isLive=!1,this.animationHappens=!1,this.isTorn=!1}switchInfluence(t,i){this.isTorn=!t;i?this.onUpperUpdate(i):this.onUpperUpdate({onTumblerUpdate:()=>{}})}onUpperUpdate(t){this.upper=t}onResize(t,i){let e=t/this.width;this.tumblerStart*=e,this.tumblerWidth*=e,this.width=t,this.height=i,this.minTumblerWidth=this.width/this.tumblerLimiter,this.upper.onTumblerUpdate(this.tumblerStart,this.tumblerWidth),this.update(this.tumblerStart,this.tumblerWidth)}handleTumblerDown(t){if(this.parentHTML.querySelector(".tooltipArea").dispatchEvent(new Event("mouseleave")),!0===this.isTorn)return;window.sliderDown=!0;let i=(this.events.isDesktop?t.clientX:t.changedTouches[0].clientX)-this.html.getBoundingClientRect().left-this.tumblerStart;if(i>0&&i<=this.tumblerWidth){let e=null;i<15?e="l":i>this.tumblerWidth-15&&(e="r"),null===e?this.handleTumblerMove(i):this.handleTumblerExtend(t,e),document[this.events.up]=(()=>{window.sliderDown=!1,document[this.events.move]=document.onmouseup=null})}}handleTumblerMove(t){document[this.events.move]=(i=>{let e=(this.events.isDesktop?i.clientX:i.changedTouches[0].clientX)-this.html.getBoundingClientRect().left,s=e-t;if(this.isLive){if(!this.animationHappens){let t=Math.abs(e-this.tumblerStart);this.updateLiveSliderTreshold(t),Math.abs(s-this.tumblerStart)>=this.threshold&&(s=this.calcAnimOffset("left",s),h.call(this),this.initAnimateTumbler(s,this.tumblerWidth))}}else h.call(this),this.upper.onTumblerUpdate(s,this.tumblerWidth,!0),this.update(s,this.tumblerWidth);function h(){let t=this.width-this.tumblerWidth;s<0?s=0:s>t&&(s=t)}})}handleTumblerExtend(t,i){let e=(this.events.isDesktop?t.clientX:t.changedTouches[0].clientX)-this.html.getBoundingClientRect().left,s=this.tumblerWidth,h=this.tumblerStart,a=this.width-(h+s);document[this.events.move]=(t=>{let n,r,l=(this.events.isDesktop?t.clientX:t.changedTouches[0].clientX)-this.html.getBoundingClientRect().left,o=l-e;if("r"===i?(n=s+o,r=h):(n=s-o,r=this.width-(a+n)),this.isLive){if(!this.animationHappens){let t;t="r"===i?Math.abs(l-(this.tumblerStart+this.tumblerWidth)):Math.abs(l-this.tumblerStart),this.updateLiveSliderTreshold(t),Math.abs(n-this.tumblerWidth)>=this.threshold&&(r=this.calcAnimOffset("left",r),n=this.calcAnimOffset("width",n),d.call(this),this.initAnimateTumbler(r,n))}}else d.call(this),this.upper.onTumblerUpdate(r,n,!0),this.update(r,n);function d(){if("r"===i){n+h>this.width&&(n=this.width-h)}else r<0&&(n=this.width-a,r=0);n<this.minTumblerWidth?(n=this.minTumblerWidth,"l"===i&&(r=this.width-this.minTumblerWidth-a)):n>this.width&&(n=this.width)}})}updateLiveSliderTreshold(t){let i;i=t>.75*this.minTumblerWidth?1:.5,this.threshold=i*this.minTumblerWidth}update(t,i){this.tumblerStart=t,this.tumblerWidth=i,this.draw()}calcAnimOffset(t,i){let e,s;if("left"===t){0!==(e=i-this.tumblerStart)&&(s=this.tumblerStart+this.minTumblerWidth*Math.round(e/this.threshold))}else if("width"===t){0!==(e=i-this.tumblerWidth)&&(s=this.tumblerWidth+this.minTumblerWidth*Math.round(e/this.threshold))}return void 0===s?i:s}initAnimateTumbler(t,i,e=this.liveDur,s){let h,a;this.updateDT(),this.dur=e,this.durProgress=0,h=t-this.tumblerStart,a=i-this.tumblerWidth,0===h&&0===a||(this.animBiasOfStart=h/e,this.animBiasOfTumblerWidth=a/e,this.animationHappens=!0,cancelAnimationFrame(this.requestID),this.animateTumbler(t,i,s))}animateTumbler(t,i,e){this.updateDT(),this.durProgress+=this.dt;let s=!0,h=this.tumblerStart+this.animBiasOfStart*this.dt,a=this.tumblerWidth+this.animBiasOfTumblerWidth*this.dt;this.durProgress<this.dur?(this.tumblerStart=h,this.tumblerWidth=a,this.upper.onTumblerUpdate(this.tumblerStart,this.tumblerWidth,!1)):(this.tumblerStart=t,this.tumblerWidth=i,this.animationHappens=!1,s=!1,this.upper.onTumblerUpdate(this.tumblerStart,this.tumblerWidth,!0)),this.update(this.tumblerStart,this.tumblerWidth),s?this.requestID=requestAnimationFrame(()=>this.animateTumbler(t,i,e)):e&&e(!0)}updateDT(){let t=Date.now();this.dt=t-this.lastTime,this.lastTime=t}draw(){let t=this.ctx;t.clearRect(0,0,this.width,this.height),t.fillStyle=window.theme.sliderMask,I(t,0,0,this.width,this.height,15,!0,!1),t.fillStyle=window.theme.tumbler;let i=!1;"day"===window.themeType&&(i=!0,t.strokeStyle="white",t.lineWidth=1),I(t,this.tumblerStart,0,this.tumblerWidth,this.height,15,!0,i);let e=this.borders[0],s=this.borders[1];t.clearRect(this.tumblerStart+e,s,this.tumblerWidth-2*e,this.height-2*s),i&&t.strokeRect(this.tumblerStart+e,s,this.tumblerWidth-2*e,this.height-2*s);let h=this.height/2.5;t.strokeStyle="white",t.lineWidth=4,t.lineCap="round",t.beginPath(),t.moveTo(this.tumblerStart+e/2,this.height-h),t.lineTo(this.tumblerStart+e/2,0+h),t.stroke(),t.beginPath(),t.moveTo(this.tumblerStart+this.tumblerWidth-e/2,this.height-h),t.lineTo(this.tumblerStart+this.tumblerWidth-e/2,0+h),t.stroke()}}function E(t){let i=t.columns,e=i.map(t=>t.slice(1)).slice(1),s=i[0].slice(1),h=Object.values(t.colors),a=Object.values(t.names),n=e[0].length;return{valuesY:e,dates:s,colors:h,names:a,valuesNumber:n,linesNumber:n-1}}class z{constructor(t,i,e,s){this.data={},this.types=e,this.typeIndex=s,this.sliderK=.95,this.html=t.appendChild(document.createElement("div")),this.html.className="box",this.ratio=[5,62,11,22],this.tumblerLimiter=7,this.zoomedScopeStartK="daily"===e[0][0]?1:7,this.title=i,this.transDur=200,this.zoomed=!1,this.buildHeader(),this.buildCanvases(),this.loaderHTML=this.html.appendChild(document.createElement("div")),this.loaderHTML.className="loaderBox",this.loaderHTML.appendChild(document.createElement("div")).className="cssload-speeding-wheel",this.setSizes(),this.tooltipHTML=this.html.appendChild(document.createElement("div")),this.tooltipHTML.style.zIndex=1,this.tooltipHTML.className="tooltip",this.tooltipAreaHTML=this.html.appendChild(document.createElement("div")),this.tooltipAreaHTML.style.position="absolute",this.tooltipAreaHTML.style.zIndex=2,this.tooltipAreaHTML.className="tooltipArea",this.getDataFromServer().then(t=>{this.data=E(t),1===this.data.names.length||this.buildCheckBoxes(),this.setSizes(),this.initCanvases()})}getDataFromServer(t,i){let e=!1,s=setTimeout(()=>{this.loaderHTML.style.display="flex",this.loaderHTML.style.opacity=1,e=!0},100),h=t&&5!=this.typeIndex?`${this.typeIndex}/${t}/${i}`:this.typeIndex;return fetch(`https://dkuskov.ru/getTelechartData/${h}`).then(t=>(clearTimeout(s),!0===e&&(setTimeout(()=>this.loaderHTML.style.display="none",600),this.loaderHTML.style.opacity=0),t.json())).catch(t=>(this.loaderHTML.style.display="none",this.loaderHTML.style.opacity=0,alert("Connection Error"),null))}defineZoomRange(t){let i=t.l,e=t.i-i,s=this.zoomedScopeStartK,h=Math.floor(this.zoomedScopeStartK/2),a=e-h,n=e+h;a===n&&n++;let r=t.coordsX.length-1;return a<0?(a=0,n=s-1):n>r&&(a=(n=r)-s+1),[a,n]}setZoomParams(t,i){let[e,s]=i,h=t.coordsX[e],a=t.coordsX[s],n=this.sizes.w;this.upperXZoomParams={leftK:h/n,middleK:(a-h)/n},this.globalZoomOffset=t.i/this.data.valuesNumber,this.lowerXZoomParams={leftK:this.globalZoomOffset,middleK:this.zoomedScopeStartK/this.data.valuesNumber}}applyZoomParams(t,i,e){let s=this.sizes.lW,h=this.slider.tumblerWidth,a=i.middleK*s,n={tumblerStart:-(i.leftK*s)/a*s,tumblerWidth:s*s/a},r={tumblerStart:this.globalZoomOffset*s-h*i.middleK/2,tumblerWidth:h*i.middleK};1===e?(t.from=n,t.to=r):-1===e&&(t.from=r,t.to=n)}onZoom(t,i,e,s){if(!0===this.zoomed)return;this.zoomed=!0;let h=this.defineZoomRange(t);this.setZoomParams(t,h);let a=String(n.indexOf(e)+1);1===a.length&&(a="0"+a);let r=`${s}-${a}`,l=String(i);if(1===l.length&&(l="0"+l),5===this.typeIndex){this.data2=this.data;let i=t.l;this.data=function(t,i,e){let s=Object.assign({},t);return s.valuesY=s.valuesY.map(t=>t.slice(i,e+1)),s.dates=s.dates.slice(i,e+1),s.valuesNumber=e-i+1,s.linesNumber=s.valuesNumber-1,s}(this.data2,i+h[0],i+h[1]),o.call(this)}else this.getDataFromServer(r,l).then(t=>{null!==t?(this.data2=this.data,this.data=E(t),o.call(this)):this.zoomed=!1});function o(){this.titleHTML.textContent="Zoom Out",this.headerTitleHTML.style.color=window.theme.zoomOutText,this.headerTitleHTML.onclick=this.onZoomOut.bind(this);let t=this.headerTitleHTML.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg"));t.setAttribute("viewBox","0 0 24 24"),t.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d","M9,2C5.1,2,2,5.1,2,9s3.1,7,7,7c1.7,0,3.3-0.7,4.6-1.7l0.4,0.4V16l5.6,5.6c0.6,0.6,1.4,0.6,2,0s0.6-1.4,0-2L16,14h-1.3 l-0.4-0.4C15.3,12.3,16,10.7,16,9C16,5.1,12.9,2,9,2z M9,4c2.8,0,5,2.2,5,5s-2.2,5-5,5s-5-2.2-5-5S6.2,4,9,4z M10.8,10.1H7.2 c-0.6,0-1.1-0.5-1.1-1.1v0c0-0.6,0.5-1.1,1.1-1.1h3.6c0.6,0,1.1,0.5,1.1,1.1v0C11.9,9.6,11.4,10.1,10.8,10.1z"),this.makeTransition(...this.types[1],1),this.upper.zoomed=!0,this.upper.hoursMode=!0,this.slider.isLive=!0,5===this.typeIndex&&(this.lower.chartController.columnMode=!0)}}onZoomOut(){!0!==this.slider.isTorn&&(this.zoomed=!1,this.data=this.data2,this.headerTitleHTML.querySelector("svg").remove(),this.headerTitleHTML.style.color=window.theme.text,this.headerTitleHTML.onclick=null,this.titleHTML.textContent=this.title,this.makeTransition(...this.types[0],-1),this.upper.zoomed=!1,this.upper.hoursMode=!1,this.slider.isLive=!1,5===this.typeIndex&&(this.lower.chartController.columnMode=!1))}makeTransition(t,i,e){this.tooltipHTML.style.display="none",this.upper.onSelectionChange(),this.slider.switchInfluence(!1);let s,h,a=this.upperHTML,n=this.lowerHTML,{w:r,lW:l,uH:o,lH:d}=this.sizes;if(1===e){this.savedSliderParams={tumblerStart:this.slider.tumblerStart/l,tumblerWidth:this.slider.tumblerWidth/l};let t=this.zoomedScopeStartK,i=Math.floor(this.zoomedScopeStartK/2);s=l*i/t,h=l/t}else-1===e&&(s=this.savedSliderParams.tumblerStart*l,h=this.savedSliderParams.tumblerWidth*l);let u={},m={};this.applyZoomParams(u,this.upperXZoomParams,e),this.applyZoomParams(m,this.lowerXZoomParams,e),Promise.all([new Promise(function(e){let[a,n]=[this.upper,this.lower];this.upperHTML=this.html.appendChild(document.createElement("canvas")),this.upperHTML.style.position="absolute","daily"!==this.types[0][0]&&(this.lowerHTML=this.html.appendChild(document.createElement("canvas")),this.lowerHTML.style.position="absolute");let c=this.upperHTML.getContext("2d");if(this.upper=new B(t,c,r,o,this.sliderK,this.data,s,h,this.upperHTML,this.updateHeaderDate.bind(this),this.onZoom.bind(this)),c=this.lowerHTML.getContext("2d"),"daily"===this.types[0][0]){let t=this.html.querySelectorAll(".lowerBar");null===i?([].forEach.call(t,t=>{t.style.transform="perspective(10px) translateZ(-10px)",t.style.opacity=0}),this.buildCheckBoxes()):([].forEach.call(t,t=>{t.style.transform="perspective(10px) translateZ(0)",t.style.opacity=1}),this.removeCheckBoxes())}else this.lower=new W(i,c,l,d,1,this.data,0,l,this.html);this.onResize(),this.upper.initAppearAnimation(u.from,this.transDur),a.initDisappearAnimation(u.to,this.transDur,e),"daily"!==this.types[0][0]&&(this.lower.initAppearAnimation(m.from,this.transDur),n.initDisappearAnimation(m.to,this.transDur,e))}.bind(this)),new Promise(function(t){this.slider.initAnimateTumbler(s,h,this.transDur,t)}.bind(this))]).then(()=>{this.tooltipHTML.style.display="flex",this.switchTooltip(!0),this.html.removeChild(a),"daily"===this.types[0][0]||this.html.removeChild(n),this.slider.switchInfluence(!0,this.upper)})}switchTooltip(t){let i=t?"mouseenter":"mouseleave";this.upper.upperListener.areaHTML.dispatchEvent(new Event(i))}buildHeader(){this.headerHTML=this.html.appendChild(document.createElement("div")),this.headerHTML.className="header",this.headerTitleHTML=this.headerHTML.appendChild(document.createElement("div")),this.headerTitleHTML.className="headerTitle",this.titleHTML=this.headerTitleHTML.appendChild(document.createElement("div")),this.titleHTML.textContent=this.title,this.headerDateHTML=this.headerHTML.appendChild(document.createElement("div")),this.headerDateHTML.className="headerDate"}buildCanvases(){this.upperHTML=this.html.appendChild(document.createElement("canvas")),this.lowerHTML=this.html.appendChild(document.createElement("canvas")),this.sliderHTML=this.html.appendChild(document.createElement("canvas")),this.upperHTML.style.position="absolute",this.lowerHTML.style.position="absolute",this.lowerHTML.className="lowerBar",this.sliderHTML.style.position="absolute",this.sliderHTML.className="lowerBar",this.sliderHTML.style.zIndex=1}buildCheckBoxes(){this.checksBlock=new s(this.html,this.data,this.updateChartChecks.bind(this))}removeCheckBoxes(){this.checksBlock.clear()}initCanvases(){let t,{w:i,lW:e,lH:s,uH:h}=this.sizes;t=this.upperHTML.getContext("2d"),this.upper=new B(this.types[0][0],t,i,h,this.sliderK,this.data,0,e/this.tumblerLimiter,this.upperHTML,this.updateHeaderDate.bind(this),this.onZoom.bind(this)),t=this.lowerHTML.getContext("2d"),this.lower=new W(this.types[0][1],t,e,s,1,this.data,0,e,this.html),t=this.sliderHTML.getContext("2d"),this.slider=new O(t,this.sliderHTML,e,s,this.tumblerLimiter,this.upper),this.upper.animate(!0),this.lower.animate(!0),this.slider.update(0,e/this.tumblerLimiter)}updateChartChecks(t,i){this.switchTooltip(!1),this.upper.onCheckBoxesStateChange(t,i),"daily"===this.types[0][0]||this.lower.onCheckBoxesStateChange(t,i)}updateHeaderDate(t,i){if(this.prevDateLabels===t)return;this.prevDateLabels=t;let e=this.headerDateHTML,s=function(){let i="";t[0].forEach(t=>{i+=t+" "}),t[1]&&(i+="- ",t[1].forEach(t=>{i+=t+" "}));return i}();!0===i?(e.style.opacity=0,e.style.transformOrigin="left top",e.style.transform="scale(.5)",setTimeout(()=>{e.style.opacity=1,e.style.transformOrigin="right bottom",e.style.transform="scale(1)",e.textContent=s},100)):e.textContent=s}onResize(){this.setSizes();let{w:t,lW:i,uH:e,lH:s}=this.sizes;this.upper.onResize(t,e),this.lower.onResize(i,s),this.slider.onResize(i,s)}setSizes(){let t=document.documentElement.clientWidth,i=.03*t,e=document.documentElement.clientHeight;e<600&&(e=600),this.sizes={w:t-i,lW:(t-i)*this.sliderK,hH:e*this.ratio[0]/100,uH:e*this.ratio[1]/100,lH:e*this.ratio[2]/100};let{w:s,lW:h,hH:a,uH:n,lH:r}=this.sizes;this.html.style.left=i/2,this.html.style.width=s,this.html.style.height=e,this.upperHTML.style.top=a,this.upperHTML.setAttribute("width",s),this.upperHTML.setAttribute("height",n),this.lowerHTML.style.top=a+n,this.lowerHTML.setAttribute("width",h),this.lowerHTML.setAttribute("height",r),this.sliderHTML.style.top=a+n,this.sliderHTML.setAttribute("width",h),this.sliderHTML.setAttribute("height",r),this.headerHTML.style.height=a,this.headerHTML.style.lineHeight=a+"px",this.headerHTML.style.width=s,this.loaderHTML.style.height=a+n+r;let l=a+n+r,o=l;"daily"===this.types[0][0]?(this.checksBlock&&(this.checksBlock.html.style.top=l-r),o+=r):this.checksBlock&&(this.checksBlock.html.style.top=l,o+=this.checksBlock.html.offsetHeight),this.html.style.height=o}setTheme(){let t=this.upper&&this.upper.zoomed;this.headerTitleHTML.style.color=t?window.theme.zoomOutText:window.theme.text,this.headerDateHTML.style.color=window.theme.text,this.tooltipHTML.style.background=window.theme.tooltip,this.tooltipHTML.style.color=window.theme.tooltipText,this.loaderHTML.style.background=window.theme.background,this.upper&&this.onResize()}}var P={day:{background:"white",sliderMask:"rgba(226, 238, 249, .6)",tumbler:"rgb(192, 209, 225)",tooltip:"white",tooltipText:"black",gridLines:"rgba(24, 45, 59, .1)",zoomOutText:"rgb(16, 139, 227)",XYAxis:"rgba(37, 37, 41, .5)",highlightMask:"rgba(255, 255, 255, .5)",text:"black"},night:{background:"rgb(36, 47, 62)",sliderMask:"rgba(48, 66, 89, .6)",tumbler:"rgb(86, 98, 109)",tooltip:"rgb(28, 37, 51)",tooltipText:"white",gridLines:"rgba(255, 255, 255, .1)",zoomOutText:"rgb(72, 170, 240)",XYAxis:"rgba(236, 242, 248, .5)",highlightMask:"rgba(36, 47, 62, .5)",text:"white"}};let N=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=N;let X=[[["lines","lines"],["lines","lines"]],[["lines2Y","lines2Y"],["lines2Y","lines2Y"]],[["stacked","stacked"],["stacked","stacked"]],[["daily","daily"],["lines",null]],[["percentage","percentage"],["pie","percentage"]]];new class{constructor(t){this.isDesktop=!("ontouchstart"in window),this.html=document.getElementById(t),this.html.setAttribute("id","app"),this.boxesWrapper=this.html.appendChild(document.createElement("div")),this.boxesWrapper.className="boxesWrapper",this.boxes=[];for(let t=0;t<X.length;t++)this.boxes.push(new z(this.boxesWrapper,"#"+(t+1),X[t],t+1));this.themeSwitcherHTML=this.html.appendChild(document.createElement("div")),this.themeSwitcherHTML.className="themeSwitcher",this.theme="night",this.switchTheme(),this.themeSwitcherHTML.onclick=this.switchTheme.bind(this);let i=this.isDesktop?"onresize":"onorientationchange";window[i]=this.handleResize.bind(this)}switchTheme(){switch("day"===this.theme?this.theme="night":this.theme="day",this.theme){case"day":this.themeSwitcherHTML.textContent="Switch to Night Mode",window.theme=P.day;break;case"night":this.themeSwitcherHTML.textContent="Switch to Day Mode",window.theme=P.night}window.themeType=this.theme,this.boxes.forEach(t=>t.setTheme()),document.body.style.background=window.theme.background}handleResize(){function t(){this.boxes.forEach(t=>t.onResize())}this.isDesktop?t.call(this):setTimeout(t.bind(this),200)}}("tg-chart")}]);